<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400" rel="stylesheet" />
    <link href="/css/list.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <title>Comparto HTML CSS Template</title>
</head>

<body>
<!-- Back to top button -->

<section>
    <div class="tm-bg-color-5">
        <h2 class="tm-text-white tm-contact-title" th:text="${message}"></h2>
    </div>
    <div class="tm-social-icon">
    </div>

    <div class="tm-social-icon">

        <table class="styled-table">
            <thead>
            <tr class="table--header">
                <th>Subject</th>
                <th>Message</th>
                <th>Priority</th>
                <th>Created Date</th>
                <th sec:authorize="hasAnyRole('ROLE_SUPERUSER', 'ROLE_ADMINISTRATOR')">Assigned</th>
                <th>Options</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="ticket, itemStat: ${listTicketsCreated}">
                <td><p th:text="${ticket.subject}"></p></td>
                <td><textarea th:text="${ticket.message}" rows="6" cols="50" name="message" class="form-control" placeholder="New Message..."
                              required="" disabled></textarea></td>
                <td><p th:text="${ticket.priority}"></p></td>
                <td><p th:text="${ticket.createdAt}"></p></td>
                <td sec:authorize="hasAnyRole('ROLE_SUPERUSER', 'ROLE_ADMINISTRATOR')" >
                    <form th:action="@{/editAssignee(ticketId=${ticket.id}, relationship=${relationship})}" th:object="${assigneeDTO}" method="POST">
                        <select  th:field="*{assigneeId}" onchange="this.form.submit()">
                            <option value="0" th:text="${ticket?.assignee?.firstName != null ? ticket?.assignee?.firstName + ' ' + ticket?.assignee?.lastName : 'Unassigned' }"></option>
                            <option th:each="user : ${listOfUserDTOInsideDepartment}"
                                    th:if="${user.email != ticket?.assignee?.email and user.department.name == ticket.creator.department.name}"
                                    th:value="${user.id}"
                                    th:text="${relationship != 'admin' ? user.firstName + ' ' + user.lastName : user.firstName + ' ' + user.lastName + ' - ' + user.department.name}"> // add department
                            </option>
                        </select>
                    </form>

                </td>
                <td class="updateAndDelete">
                    <p><a th:href="@{/editTicket(ticketId=${ticket.id},relationship=${relationship})}">Update</a></p>
                    <p><a th:href="@{/closeTicket(ticketId=${ticket.id},relationship=${relationship})}">Close</a></p>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</section>



<footer class="tm-social-icon tm-bg-color-5">
    <div>
        <a th:href="@{/dashboard}" class="tm-btn tm-btn-3 link-mouse-pointer-like-btn">DASHBOARD</a>
    </div>
</footer>
</div> <!-- .container -->
</body>
</html>